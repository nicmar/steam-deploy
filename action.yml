name: 'Steam - Deploy'
author: Webber Takken <webber@takken.io>
description: 'Deploy game builds to Steam using the SteamSDK.'
inputs:
  username:
    required: true
    default: ''
    description: 'The username of your builder account.'
  password:
    required: true
    default: ''
    description: 'The password of your builder account.'
  configVdf:
    required: true
    default: ''
    description: 'The contents of STEAM_HOME/config/config.vdf.'
  ssfnFileName:
    required: true
    default: ''
    description: 'The basename of the STEAM_HOME/ssfn file.'
  ssfnFileContents:
    required: true
    default: ''
    description: 'The contents of the file at STEAM_HOME/ssfnFileName.'
  appId:
    required: true
    default: ''
    description: 'The app id within steam partner network.'
  firstDepotIdOverride:
    required: false
    description: 'An optional override to specify the ID of the first depot instead of using the app ID plus one.'
  buildDescription:
    required: false
    description: 'Description for this build.'
  rootPath:
    required: false
    description: 'The root path to your builds. This is the base of which depots will search your files.'
  depot1Path:
    required: false
    description: 'The path to depot1.'
  depot2Path:
    required: false
    description: 'The path to depot2.'
  depot3Path:
    required: false
    description: 'The path to depot3.'
  depot4Path:
    required: false
    description: 'The path to depot4.'
  depot5Path:
    required: false
    description: 'The path to depot5.'
  depot6Path:
    required: false
    description: 'The path to depot6.'
  depot7Path:
    required: false
    description: 'The path to depot7.'
  depot8Path:
    required: false
    description: 'The path to depot8.'
  depot9Path:
    required: false
    description: 'The path to depot9.'
  releaseBranch:
    required: false
    description: 'The branch within steam that this build will be automatically put live on.'
outputs:
  manifest:
    description: "The path to the generated manifest.vdf"
    value: ${{ steps.steam-deploy.outputs.manifest }}
runs:
  using: "composite"
  steps:
    - name: Run the build process with Docker
      uses: addnab/docker-run-action@v3
      with:
        image: cm2network/steamcmd:latest
      run: |
      echo ${{ secrets.STEAM2_SSFN_FILE_CONTENTS }} | base64 -d > /home/steam/Steam/${{ secrets.STEAM2_SSFN_FILE_NAME }}
      ./steamcmd.sh +login ${{ secrets.STEAM2_USERNAME }} ${{ secrets.STEAM2_PASSWORD }} +run_app_build $(pwd)/manifest.vdf +quit

